<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delphi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }
    .min-h-screen {
      min-height: 100vh;
    }
    .readable-heading {
      color: #1e293b;
      text-shadow: 0 2px 8px rgba(255,255,255,0.7), 0 1px 0 #fff;
      letter-spacing: 0.04em;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      font-weight: 900;
    }
    .readable-subtitle {
      color: #334155;
      text-shadow: 0 1px 6px rgba(255,255,255,0.6);
      font-weight: 600;
      font-size: 1.15rem;
      letter-spacing: 0.01em;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes bounce {
      0%, 100% {
        transform: translateY(-25%);
        animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
      }
      50% {
        transform: none;
        animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
      }
    }
    .animate-bounce {
      animation: bounce 1s infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { createRoot } = ReactDOM;
    const Search = ({ size }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-search">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.3-4.3"></path>
      </svg>
    );

    const Sparkles = ({ size }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-sparkles">
        <path d="M9.9 22.8c-2.3-3.4 1.7-6.5 2.1-10.8M20 2c-5.5 5.5-2 12-4.5 14.5M10.7 13.9c-2.5-2.5-12.8-9.1-11-10.9 1.8-1.8 8.4 8.5 10.9 11zM10.1 2.1c1.8 1.8 4.2 6.4 5.2 8.7M13.2 21.6c1.2-.5 4.3-2.1 5-4.8"></path>
      </svg>
    );

    const App = () => {
      const [searchTerm, setSearchTerm] = useState('');
      const [isSearching, setIsSearching] = useState(false);
      const [datasetDescription, setDatasetDescription] = useState('');
      const [isGeneratingDescription, setIsGeneratingDescription] = useState(false);

      const mainContentRef = useRef(null);
      const daisyRefs = useRef([]);
      const waterRef = useRef(null);
      const rippleRefs = useRef([]);

      useEffect(() => {
        // Main content fade and slide in animation
        anime({
          targets: mainContentRef.current,
          translateY: ['20px', '0'],
          opacity: [0, 1],
          duration: 1000,
          easing: 'easeOutQuad',
        });

        // Daisy sway animation
        anime({
          targets: daisyRefs.current,
          rotate: [-5, 5],
          duration: 3000,
          loop: true,
          direction: 'alternate',
          easing: 'easeInOutSine',
          delay: anime.stagger(200, { start: 500 }),
        });

        // Water flow animation
        anime({
          targets: waterRef.current,
          translateY: ['5px', '0px'],
          duration: 5000,
          loop: true,
          direction: 'alternate',
          easing: 'easeInOutSine',
        });

        // Water ripple animation
        anime({
          targets: rippleRefs.current,
          translateX: ['-5px', '5px'],
          opacity: [0.2, 0.3],
          duration: 4000,
          loop: true,
          direction: 'alternate',
          easing: 'easeInOutQuad',
          delay: anime.stagger(1000),
        });

      }, []);

      const handleSearch = () => {
        setIsSearching(true);
        console.log(`Searching for: ${searchTerm}`);
        setTimeout(() => {
          setIsSearching(false);
        }, 2000);
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter') {
          handleSearch();
        }
      };
      
      const handleGeminiQuery = async () => {
          if (!searchTerm) return;
          setIsGeneratingDescription(true);
          setDatasetDescription('');

          let retryCount = 0;
          const maxRetries = 3;
          let delay = 1000; // 1 second

          while (retryCount < maxRetries) {
              try {
                  const prompt = `Reply in the form of a sassy Gen Z Girl : ${searchTerm}`;
                  const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                  const payload = { contents: chatHistory };
                  const apiKey = "AIzaSyBiv3UD8B6jwGS2mKPIzV09O9NNR3Eoviw";
                  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                  const response = await fetch(apiUrl, {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify(payload)
                  });

                  if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                  }

                  const result = await response.json();
                  if (result.candidates && result.candidates.length > 0 &&
                      result.candidates[0].content && result.candidates[0].content.parts &&
                      result.candidates[0].content.parts.length > 0) {
                      const text = result.candidates[0].content.parts[0].text;
                      setDatasetDescription(text);
                  } else {
                      console.error('Unexpected API response structure:', result);
                      setDatasetDescription('Could not generate a description.');
                  }
                  break; // Exit the loop on success
              } catch (error) {
                  console.error('Error fetching from Gemini API:', error);
                  retryCount++;
                  if (retryCount < maxRetries) {
                      await new Promise(res => setTimeout(res, delay));
                      delay *= 2; // Exponential backoff
                  } else {
                      setDatasetDescription('Failed to generate a description after multiple retries.');
                  }
              }
          }
          setIsGeneratingDescription(false);
      };


      const Daisy = ({ delay, scale, positionClass, index }) => {
        return (
          <div 
            ref={el => daisyRefs.current[index] = el}
            className={`absolute transition-transform duration-1000 ease-in-out ${positionClass}`} 
            style={{ animationDelay: `${delay}s`, transform: `scale(${scale})` }}
          >
            {/* Flower petals */}
            <div className="relative w-8 h-8 md:w-10 md:h-10 rounded-full bg-white bg-opacity-70 shadow-md">
              <div className="absolute w-6 h-6 md:w-8 md:h-8 rounded-full bg-white top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 -rotate-45"></div>
              <div className="absolute w-6 h-6 md:w-8 md:h-8 rounded-full bg-white top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 rotate-45"></div>
              <div className="absolute w-6 h-6 md:w-8 md:h-8 rounded-full bg-white top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 rotate-90"></div>
              <div className="absolute w-6 h-6 md:w-8 md:h-8 rounded-full bg-white top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></div>
              {/* Center of the daisy */}
              <div className="absolute w-4 h-4 md:w-6 md:h-6 rounded-full bg-yellow-300 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 shadow-inner"></div>
            </div>
            {/* Stem */}
            <div className="absolute w-0.5 h-12 md:h-16 bg-green-500 top-full left-1/2 transform -translate-x-1/2 z-[-1] rounded-b-full"></div>
          </div>
        );
      };

      return (
        <div className="relative min-h-screen font-sans overflow-hidden p-4 flex flex-col items-center justify-center bg-gradient-to-br from-blue-200 to-green-100">
          
          {/* Background layer for daisies and water */}
          <div className="absolute inset-0 z-0">
            {/* Daisy Field */}
            <Daisy scale={0.8} positionClass="bottom-16 left-10 md:left-24 lg:left-40" index={0} />
            <Daisy scale={1} positionClass="bottom-20 right-20 md:right-40" index={1} />
            <Daisy scale={0.9} positionClass="bottom-10 left-1/2 transform -translate-x-1/2" index={2} />
            <Daisy scale={0.7} positionClass="bottom-24 left-1/4" index={3} />
            <Daisy scale={0.6} positionClass="bottom-14 right-1/4" index={4} />
            
            {/* Water Source */}
            <div ref={waterRef} className="absolute bottom-0 w-full h-40 bg-gradient-to-b from-transparent via-blue-200 to-blue-400 opacity-70">
              <div className="absolute bottom-0 w-full h-full bg-blue-300 opacity-30 animate-pulse"></div>
              {/* Animated water ripples */}
              <div ref={el => rippleRefs.current[0] = el} className="absolute w-[120%] h-12 -left-10 bottom-10 bg-white opacity-20 blur-sm rounded-full"></div>
              <div ref={el => rippleRefs.current[1] = el} className="absolute w-[110%] h-8 -right-5 bottom-20 bg-white opacity-20 blur-sm rounded-full"></div>
            </div>
          </div>

          {/* Main Content Area */}
          <div ref={mainContentRef} className="flex flex-col items-center justify-center p-8 bg-white/30 backdrop-blur-sm rounded-3xl shadow-xl z-10 w-full max-w-2xl transform transition-transform duration-500 hover:scale-[1.01]">
            <h1 className="text-3xl md:text-5xl font-extrabold text-center mb-2 readable-heading">
              Delphi
            </h1>
            <p className="text-sm md:text-md text-center mb-8 readable-subtitle">
              A gentle path to your data.
            </p>

            {/* Search and Gemini Input */}
            <div className="relative w-full flex space-x-2">
              <input
                type="text"
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder="Wassup Baby Doll"
                className="flex-grow pl-5 pr-4 py-3 rounded-full text-gray-800 bg-white/70 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:bg-white transition-colors duration-300 shadow-md placeholder-gray-500"
              />
              <button
                onClick={handleSearch}
                disabled={isSearching}
                className="p-3 rounded-full bg-blue-400 hover:bg-blue-500 transition-colors duration-300 text-white shadow-lg disabled:bg-blue-300 disabled:cursor-not-allowed"
              >
                <Search size={20} />
              </button>
              <button
                onClick={handleGeminiQuery}
                disabled={isGeneratingDescription || !searchTerm}
                className="flex items-center space-x-2 p-3 rounded-full bg-purple-400 hover:bg-purple-500 transition-colors duration-300 text-white shadow-lg disabled:bg-purple-300 disabled:cursor-not-allowed"
              >
                <Sparkles size={20} />
              </button>
            </div>

            {/* Loading Indicator for search */}
            {isSearching && (
              <div className="mt-4 flex items-center justify-center">
                <div className="w-4 h-4 rounded-full bg-blue-400 animate-bounce mr-2"></div>
                <div className="w-4 h-4 rounded-full bg-blue-400 animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                <div className="w-4 h-4 rounded-full bg-blue-400 animate-bounce ml-2" style={{ animationDelay: '0.4s' }}></div>
              </div>
            )}
            
            {/* Gemini Description */}
            {(isGeneratingDescription || datasetDescription) && (
              <div className="mt-8 w-full p-6 bg-white/70 backdrop-blur-sm rounded-xl shadow-md text-gray-800">
                <h3 className="text-xl font-bold mb-2 text-gray-700">Response ✨</h3>
                {isGeneratingDescription ? (
                  <div className="flex items-center space-x-2">
                    <div className="w-3 h-3 rounded-full bg-purple-400 animate-pulse"></div>
                    <p>Generating description...</p>
                  </div>
                ) : (
                  <p>{datasetDescription}</p>
                )}
              </div>
            )}
          </div>
        </div>
      );
    };

    createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
